{% extends 'tienda/base.html' %}

{% block title %}Editar Categoría - {{ categoria.nombre }}{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: calc(100vh - 204px);;">
  <div class="p-4 bg-white rounded-4 border border-secondary-subtle shadow-sm w-100" style="max-width: 600px;">

    <h2 class="mb-4 text-center">Editar Categoría: <strong>{{ categoria.nombre }}</strong></h2>



    <form method="post" enctype="multipart/form-data" novalidate>
      {% csrf_token %}

      <!-- Imagen destacada actual con opción para cambiar -->
      <div class="mb-4 text-center">
        <label for="id_foto_destacada" class="d-inline-block position-relative" style="cursor: pointer;">
          {% if categoria.foto_destacada %}
          <img id="preview-img" src="{{ categoria.foto_destacada.url }}" alt="Foto de {{ categoria.nombre }}"
            class="rounded-4 border border-secondary shadow-sm"
            style="max-height: 300px; object-fit: cover; width: 100%; max-width: 100%;">
          {% else %}
          <div class="rounded-4 border border-secondary shadow-sm d-flex align-items-center justify-content-center"
            style="height: 300px; max-width: 100%; width: 100%; color: #6c757d; font-size: 1.25rem;">
            Click para subir imagen
          </div>
          {% endif %}
          <input type="file" name="foto_destacada" id="id_foto_destacada" accept="image/*" class="d-none"
            onchange="previewImage(event)">
          <div class="position-absolute top-0 end-0 bg-dark bg-opacity-50 text-white px-2 py-1 rounded-bottom-start"
            style="font-size: 0.9rem;">
            Cambiar imagen
          </div>
        </label>
      </div>

      <!-- Renderiza el resto del formulario -->
      {{ form.non_field_errors }}
      {% for field in form %}
      {% if field.name != 'foto_destacada' %}
      <div class="mb-3">
        {{ field.label_tag }}
        {{ field }}
        {% if field.help_text %}
        <small class="form-text text-muted">{{ field.help_text }}</small>
        {% endif %}
        {% for error in field.errors %}
        <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      {% endif %}
      {% endfor %}

      <div class="mt-3 d-flex justify-content-between">
        <a href="{% url 'listar_categorias' %}" class="btn btn-outline-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </div>
    </form>
  </div>
</div>

<script>
  function previewImage(event) {
    const input = event.target;
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById('preview-img');
        if (preview) {
          preview.src = e.target.result;
        }
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>
{% endblock %}